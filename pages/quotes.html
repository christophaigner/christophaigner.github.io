---
layout: page
title: Quotes
permalink: /quotes/
weight: 2
---

{% assign quotes = site.data.quotes %}

<div class="quotes-option-b">
  <header class="quotes-header">
    <h1>Collected Wisdom</h1>
    <p class="subtitle">Words that shaped my thinking</p>
  </header>

  <!-- Featured Quote with Auto-shuffle -->
  <div class="featured-quote-hero">
    <div class="featured-content">
      <blockquote id="featured-quote-text">Loading wisdom...</blockquote>
      <cite id="featured-quote-author"></cite>
    </div>
    <div class="featured-controls">
      <div class="progress-ring" id="progressRing">
        <svg viewBox="0 0 36 36">
          <circle class="progress-bg" cx="18" cy="18" r="16"/>
          <circle class="progress-bar" cx="18" cy="18" r="16" id="progressCircle"/>
        </svg>
      </div>
      <button class="shuffle-btn" id="shuffleBtn" title="New quote">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M16 3h5v5"/>
          <path d="M4 20L21 3"/>
          <path d="M21 16v5h-5"/>
          <path d="M15 15l6 6"/>
          <path d="M4 4l5 5"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="filter-section">
    <div class="filter-tabs">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="philosophy">Philosophy</button>
      <button class="filter-btn" data-filter="stoicism">Stoicism</button>
      <button class="filter-btn" data-filter="growth">Growth</button>
    </div>
  </div>

  <div class="masonry-grid">
    {% for q in quotes %}
    <article class="masonry-card" data-category="{{ q.category }}">
      <div class="card-content">
        <blockquote>{{ q.text }}</blockquote>
        <footer>
          <cite>{{ q.author }}</cite>
          <span class="tag">{{ q.category | capitalize }}</span>
        </footer>
      </div>
    </article>
    {% endfor %}
  </div>
</div>

<script type="application/json" id="quotes-data">
{{ quotes | jsonify }}
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Quotes from the single source of truth (Jekyll data)
  const quotesDataEl = document.getElementById('quotes-data');
  const allQuotes = quotesDataEl ? JSON.parse(quotesDataEl.textContent || '[]') : [];
  // Use all quotes for featured rotation
  const featuredQuotes = allQuotes;

  const quoteText = document.getElementById('featured-quote-text');
  const quoteAuthor = document.getElementById('featured-quote-author');
  const shuffleBtn = document.getElementById('shuffleBtn');
  const progressCircle = document.getElementById('progressCircle');

  let currentIndex = -1;
  const SHUFFLE_DELAY = 8000; // 8 seconds
  let timerId = null;
  let remainingMs = SHUFFLE_DELAY;
  let startedAt = null;
  let isPaused = false;

  function getRandomQuote() {
    let newIndex;
    do {
      newIndex = Math.floor(Math.random() * featuredQuotes.length);
    } while (newIndex === currentIndex && featuredQuotes.length > 1);
    currentIndex = newIndex;
    return featuredQuotes[currentIndex];
  }

  function updateQuote(animate = true) {
    const quote = getRandomQuote();

    if (animate) {
      quoteText.style.opacity = 0;
      quoteAuthor.style.opacity = 0;

      setTimeout(() => {
        quoteText.textContent = quote.text;
        quoteAuthor.textContent = '— ' + quote.author;
        quoteText.style.opacity = 1;
        quoteAuthor.style.opacity = 1;
      }, 300);
    } else {
      quoteText.textContent = quote.text;
      quoteAuthor.textContent = '— ' + quote.author;
    }

    // Reset timer + progress
    remainingMs = SHUFFLE_DELAY;
    restartProgressAnimation();
    startTimer();
  }

  function clearTimer() {
    if (timerId) {
      clearTimeout(timerId);
      timerId = null;
    }
  }

  function startTimer() {
    clearTimer();
    startedAt = performance.now();
    isPaused = false;
    timerId = setTimeout(() => {
      // Ensure the ring is fully finished before we swap
      finishProgressAnimation();
      // Next quote
      updateQuote(true);
    }, remainingMs);
  }

  function restartProgressAnimation() {
    if (!progressCircle) return;
    progressCircle.style.setProperty('--progress-duration', `${remainingMs}ms`);
    progressCircle.style.setProperty('--progress-state', 'running');
    progressCircle.classList.remove('is-running');
    // force reflow to restart animation
    void progressCircle.getBoundingClientRect();
    progressCircle.classList.add('is-running');
  }

  function finishProgressAnimation() {
    if (!progressCircle) return;
    progressCircle.style.setProperty('--progress-state', 'paused');
    progressCircle.style.strokeDashoffset = '0';
  }

  function pauseProgressAnimation() {
    if (!progressCircle) return;
    progressCircle.style.setProperty('--progress-state', 'paused');
  }

  function resumeProgressAnimation() {
    if (!progressCircle) return;
    progressCircle.style.setProperty('--progress-state', 'running');
  }

  // Manual shuffle
  shuffleBtn.addEventListener('click', () => {
    updateQuote(true);
  });

  // Pause on hover
  const featuredHero = document.querySelector('.featured-quote-hero');
  featuredHero.addEventListener('mouseenter', () => {
    if (isPaused) return;
    isPaused = true;
    const now = performance.now();
    if (startedAt) {
      remainingMs = Math.max(0, remainingMs - (now - startedAt));
    }
    clearTimer();
    pauseProgressAnimation();
  });

  featuredHero.addEventListener('mouseleave', () => {
    if (!isPaused) return;
    isPaused = false;
    startedAt = performance.now();
    resumeProgressAnimation();
    startTimer();
  });

  // Initialize
  // first quote
  const first = getRandomQuote();
  quoteText.textContent = first.text;
  quoteAuthor.textContent = '— ' + first.author;
  remainingMs = SHUFFLE_DELAY;
  restartProgressAnimation();
  startTimer();

  // Filter functionality
  const filterBtns = document.querySelectorAll('.filter-btn');
  const grid = document.querySelector('.masonry-grid');
  let cards = Array.from(document.querySelectorAll('.masonry-card'));

  // Mix quotes so they aren't grouped by category
  function shuffleInPlace(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  if (grid) {
    shuffleInPlace(cards);
    // Re-append in shuffled order
    cards.forEach(card => grid.appendChild(card));
  }

  // Typography hierarchy: size cards based on quote length and promote a few to "featured"
  function assignCardStyles() {
    // reset classes
    cards.forEach(card => card.classList.remove('size-lg', 'size-sm', 'featured'));

    const eligibleForFeatured = [];
    cards.forEach(card => {
      const textEl = card.querySelector('blockquote');
      const text = (textEl?.textContent || '').trim();
      const len = text.length;

      if (len <= 110) {
        card.classList.add('size-lg');
        eligibleForFeatured.push(card);
      } else if (len >= 220) {
        card.classList.add('size-sm');
      }
    });

    // Pick a handful of short-ish quotes to be featured (bigger padding + font)
    const FEATURED_COUNT = 6;
    shuffleInPlace(eligibleForFeatured);
    eligibleForFeatured.slice(0, FEATURED_COUNT).forEach(card => card.classList.add('featured'));
  }

  assignCardStyles();

  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      filterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      const filter = btn.dataset.filter;

      cards.forEach((card) => {
        if (filter === 'all' || card.dataset.category === filter) {
          card.style.display = 'block';
          // Fade in all at once (no stagger)
          card.style.animation = `fadeInUp 0.35s ease both`;
        } else {
          card.style.display = 'none';
        }
      });
    });
  });

  // Initial animation (all at once, no stagger)
  cards.forEach((card) => {
    card.style.animation = `fadeInUp 0.35s ease both`;
  });
});
</script>

